#  Redis

## ğŸ˜Š å¤ä¹ 

> 8å¤§æ•°æ®ç±»å‹

stringã€hashã€listã€setã€sortedSetã€Bitmapã€HyperLogLogã€GEO

> Stringç±»å‹ä½¿ç”¨åœºæ™¯

**1ã€å‘½ä»¤**

æœ€å¸¸ç”¨ï¼š`set key value`ã€`get key`

è®¾ç½®å¤šä¸ªï¼š`mset k1 v1 k2 v2`ã€`mget k1 k2`

æ•°å€¼å¢å‡ï¼š

- é€’å¢ï¼š`incr k1`
- å¢åŠ æŒ‡å®šï¼š`incrby k1 2`
- é€’å‡ï¼š`decr k1`
- å‡å°‘æŒ‡å®šï¼š`decrby k1 2`

è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼š`strlen k1`

åˆ†å¸ƒå¼é”ï¼š`setnx k1 v1`ã€`set key value [EX seconds][PX milliseconds] [NX|XX]`ã€`setex key seconds value`

- EXï¼škeyåœ¨å¤šå°‘ç§’åè¿‡æœŸ
- PXï¼škeyåœ¨å¤šå°‘æ¯«ç§’åè¿‡æœŸ

- NXï¼šå½“keyä¸å­˜åœ¨æ—¶ï¼Œæ‰åˆ›å»ºkeyï¼Œæ•ˆæœç­‰åŒäºsetnx
- XXï¼šå½“keyå­˜åœ¨æ—¶ï¼Œè¦†ç›–key

**2ã€åº”ç”¨åœºæ™¯**

- å•†å“ç¼–å·ã€è®¢å•å·é‡‡ç”¨incrå‘½ä»¤ç”Ÿæˆ

> hashåº”ç”¨åœºæ™¯

`Map<String,Map<Object,Object>>`

**1ã€å‘½ä»¤**

ä¸€æ¬¡è®¾ç½®ä¸€ä¸ªå­—æ®µå€¼ï¼š`hset k1 f1 v1`

ä¸€æ¬¡è·å–ä¸€ä¸ªå­—æ®µå€¼ï¼š`hget k1 f1`

ä¸€æ¬¡è®¾ç½®å¤šä¸ªå­—æ®µå€¼ï¼š`hmset k1 f1 v1 f2 v2`

ä¸€æ¬¡è·å–å¤šä¸ªå­—æ®µå€¼ï¼š`hmget k1 f1 f2`

è·å–æ‰€æœ‰å­—æ®µå€¼ï¼š`hgetall k1`

è·å–æŸä¸ªkeyå†…å…¨éƒ¨æ•°é‡ï¼š`hlen k1`

åˆ é™¤ä¸€ä¸ªkeyï¼š`hdel k1`

å¢åŠ ï¼š`hincrby k1 f1 2`

**2ã€åº”ç”¨åœºæ™¯**

- è´­ç‰©è½¦

> liståº”ç”¨åœºæ™¯

**1ã€å‘½ä»¤**

å·¦è¾¹æ·»åŠ ï¼š`lpush k1 1 2 3 4` 

å³è¾¹æ·»åŠ ï¼š`rpush k1 1 2 3 4`

æŸ¥çœ‹åˆ—è¡¨ï¼ˆç±»ä¼¼äºåˆ†é¡µï¼‰ï¼š`lrange k1 0 -1`

è·å–å…ƒç´ ä¸ªæ•°ï¼š`llen k1`

**2ã€åº”ç”¨åœºæ™¯**

- ç‚¹èµ

> setåº”ç”¨åœºæ™¯

**1ã€å‘½ä»¤**

æ·»åŠ å…ƒç´ ï¼š`sadd k1 m1 m2...`

åˆ é™¤å…ƒç´ ï¼š`srem k1 m1 m2...`

è·å–é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ï¼š`smembers k1`

åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼š`sismember k1 m1`

è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼š`scard k1`

ä»é›†åˆä¸­éšæœºå¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸åˆ é™¤ï¼š`srandmember k1 [æ•°å­—]`

ä»é›†åˆä¸­éšæœºå¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå‡ºä¸€ä¸ªåˆ ä¸€ä¸ªï¼š`spop k1 [æ•°å­—]`

**2ã€é›†åˆè¿ç®—**

äº¤ï¼š`sinter key1 key2`

å¹¶ï¼š`sunion key1 key2`

å·®ï¼ˆå±äºk1ä¸å±äºk2ï¼‰ï¼š`sdiff key1 key2`

**3ã€åº”ç”¨åœºæ™¯**

- å¾®ä¿¡æŠ½å¥–å°ç¨‹åº

  - å‚ä¸ï¼š`sadd key ç”¨æˆ·ID`

  - æ˜¾ç¤ºå‚ä¸äººæ•°ï¼š`scard key`
  - æŠ½å¥–ï¼š`spop k1 1`

- æœ‹å‹åœˆç‚¹èµ

  - æ–°å¢ç‚¹èµï¼š`sadd pub:msgID ç‚¹èµç”¨æˆ·1 ç‚¹èµç”¨æˆ·2 `
  - å–æ¶ˆç‚¹èµï¼š`srem pub:msgID ç‚¹èµç”¨æˆ·1`
  - å±•ç¤ºæ‰€æœ‰ç‚¹èµè¿‡çš„ç”¨æˆ·ï¼š`smembers pub:msgID`
  - ç‚¹èµç”¨æˆ·ç»Ÿè®¡ï¼š`scard pub:msgID`

- å¥½å‹ç¤¾äº¤å…³ç³»
  - å…±åŒå…³æ³¨ï¼š`sinter s1 s2`
- qqå¯èƒ½è®¤è¯†çš„äºº
  - `sdiff s1 s2`

> zsetåº”ç”¨åœºæ™¯

å‘æœ‰åºé›†åˆä¸­åŠ å…¥å…ƒç´ å’Œåˆ†æ•°

**1ã€å‘½ä»¤**

æ·»åŠ å…ƒç´ ï¼š`zadd k1 score m1`

æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å°åˆ°å¤§é¡ºåºè¿”å›ç´¢å¼•ä»startåˆ°stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼š`zrange k1 start stop [withscores]`

è·å–å…ƒç´ çš„åˆ†æ•°ï¼š`zscore k1 m1`

è·å–æ’åï¼š`zrank k1 m1`ã€`zrevrank k1 m1`

å¢åŠ ï¼š`zincrby key 1 m1`

**2ã€åœºæ™¯**

- çƒ­æœ

- æ’åºæ˜¾ç¤º

> åˆ†å¸ƒå¼é”



















## ğŸ˜Š å…¥é—¨

**é—®é¢˜ç°è±¡**

- æµ·é‡ç”¨æˆ·
- é«˜å¹¶å‘

**å…³ç³»å‹æ•°æ®åº“**

- æ€§èƒ½ç“¶é¢ˆï¼šç£ç›˜IOæ€§èƒ½ä½ä¸‹
- æ‰©å±•ç“¶é¢ˆï¼šæ•°æ®å…³ç³»å¤æ‚ã€æ‰©å±•æ€§å·®ã€ä¸ä¾¿äºå¤§è§„æ¨¡é›†ç¾¤

**è§£å†³æ€è·¯**

- é™ä½ç£ç›˜IOæ¬¡æ•°
- å»é™¤æ•°æ®é—´å…³ç³»ï¼Œè¶Šç®€å•è¶Šå¥½

### Nosql

1ã€Nosqlï¼šéå…³ç³»å‹æ•°æ®åº“ï¼Œä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„è¡¥å……

2ã€**ä½œç”¨ï¼š**åº”å¯¹åŸºäºæµ·é‡ç”¨æˆ·å’Œæµ·é‡æ•°æ®å‰æä¸‹çš„æ•°æ®å¤„ç†é—®é¢˜

3ã€ç‰¹å¾ï¼š

- å¯æ‰©å®¹ã€å¯ä¼¸ç¼©
- å¤§æ•°æ®é‡ä¸‹é«˜æ€§èƒ½
- çµæ´»çš„æ•°æ®æ¨¡å‹
- é«˜å¯ç”¨

**4ã€å¸¸è§Nosqlæ•°æ®åº“ï¼š**

- Redis
- memcache
- HBase
- MongoDB

#### è§£å†³æ–¹æ¡ˆï¼ˆç”µå•†åœºæ™¯ï¼‰

1ã€å•†å“çš„åŸºæœ¬ä¿¡æ¯ï¼šåç§°ã€ä»·æ ¼ã€å‚å•†ï¼ˆMySQLï¼‰

2ã€å•†å“é™„åŠ ä¿¡æ¯ï¼šæè¿°ã€è¯¦æƒ…ã€è¯„è®ºï¼ˆMongoDBï¼‰

3ã€å›¾ç‰‡ä¿¡æ¯ï¼šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ

4ã€æœç´¢å…³é”®å­—

**5ã€çƒ­ç‚¹ä¿¡æ¯ï¼šé«˜é¢‘ç‡ã€æ³¢æ®µæ€§ï¼ˆRedisï¼‰**

<img src="https://img-blog.csdnimg.cn/20210417151717501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:60%;" />

### ç®€ä»‹

æ¦‚å¿µï¼šç”¨Cè¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½**é”®å€¼å¯¹æ•°æ®åº“**

ç‰¹å¾ï¼š

- æ•°æ®é—´æ²¡æœ‰å¿…ç„¶çš„å…³è”å…³ç³»
- å†…éƒ¨ä½¿ç”¨**å•çº¿ç¨‹**
- é«˜æ€§èƒ½
- å¤šæ•°æ®ç±»å‹æ”¯æŒ
  - å­—ç¬¦ä¸²ç±»å‹ string
  - åˆ—è¡¨ç±»å‹ list
  - æ•£åˆ—ç±»å‹ hash
  - é›†åˆç±»å‹ set
  - æœ‰åºé›†åˆç±»å‹ zset
- æŒä¹…åŒ–æ”¯æŒï¼Œå¯ä»¥è¿›è¡Œæ•°æ®ç¾éš¾æ¢å¤

### åº”ç”¨

1ã€ä¸ºçƒ­ç‚¹æ•°æ®åŠ é€ŸæŸ¥è¯¢ï¼Œå¦‚çƒ­ç‚¹å•†å“ã€çƒ­ç‚¹æ–°é—»ç­‰

2ã€**ä»»åŠ¡é˜Ÿåˆ—**ï¼Œå¦‚ç§’æ€ã€æŠ¢è´­ç­‰

3ã€**å³ä½¿ä¿¡æ¯æŸ¥è¯¢**ï¼Œå¦‚æ’è¡Œæ¦œã€è®¿é—®ç»Ÿè®¡ç­‰

4ã€**æ—¶æ•ˆä¿¡æ¯æ§åˆ¶**ï¼Œå¦‚éªŒè¯ç 

5ã€æ¶ˆæ¯é˜Ÿåˆ—

6ã€åˆ†å¸ƒå¼é”

### åŸºæœ¬æ“ä½œ

**1ã€æ·»åŠ ä¿¡æ¯**

- åŠŸèƒ½ï¼šè®¾ç½®keyï¼Œvalue

```sql
set name zhang
```

**2ã€æŸ¥è¯¢ä¿¡æ¯**

```sql
get name
```

## ğŸ˜Š æ•°æ®ç±»å‹

### ä»‹ç»

ä¸šåŠ¡æ•°æ®çš„ç‰¹æ®Šæ€§

**1ã€ä½œä¸ºç¼“å­˜ä½¿ç”¨**

- åŸå§‹ä¸šåŠ¡åŠŸèƒ½è®¾è®¡ï¼šç§’æ€ã€åŒ11ã€12306
- è¿è¥å¹³å°ç›‘æ§åˆ°çš„çªå‘é«˜é¢‘è®¿é—®æ•°æ®ï¼šçªå‘æ—¶æ”¿è¦é—»
- é«˜é¢‘ã€å¤æ‚çš„ç»Ÿè®¡æ•°æ®ï¼šåœ¨çº¿äººæ•°ã€æŠ•ç¥¨æ’è¡Œæ¦œ

**2ã€é™„åŠ åŠŸèƒ½**

- ç³»ç»ŸåŠŸèƒ½ä¼˜åŒ–æˆ–å‡çº§ï¼šå•æœåŠ¡å™¨å‡çº§é›†ç¾¤ã€Sessionç®¡ç†

**3ã€redisæ•°æ®å­˜å‚¨æ ¼å¼**

redisæ˜¯ä¸€ä¸ªMapï¼Œå…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨key-valueçš„å½¢å¼å­˜å‚¨

- **æ•°æ®ç±»å‹æŒ‡çš„æ˜¯å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯valueéƒ¨åˆ†çš„ç±»å‹ï¼Œkeyæ°¸è¿œæ˜¯å­—ç¬¦ä¸²**

### string

**1ã€å­˜å‚¨çš„æ•°æ®ï¼šå•ä¸ªæ•°æ®ï¼Œæœ€ç®€å•çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼Œæœ€å¸¸ç”¨**

**2ã€å­˜å‚¨æ•°æ®çš„æ ¼å¼ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜ä¸€ä¸ªæ•°æ®**

3ã€å­˜å‚¨å†…å®¹ï¼šé€šå¸¸ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå¦‚æœä»¥æ•´æ•°å½¢å¼å±•ç¤ºï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ•°å­—æ“ä½œ

4ã€åŸºæœ¬æ“ä½œ

- æ·»åŠ /ä¿®æ”¹æ•°æ®ï¼š`set key value`
- è·å–æ•°æ®ï¼š`get key`
- åˆ é™¤æ•°æ®ï¼š`del key`

```sql
127.0.0.1:6379> del name                                                                  
(integer) 1 # æ“ä½œæˆåŠŸ
127.0.0.1:6379> del name                                                                  
(integer) 0 # æ“ä½œå¤±è´¥
```

- æ·»åŠ /ä¿®æ”¹å¤šä¸ªæ•°æ®ï¼š`mset key1 value1 key2 value2`
- è·å–å¤šä¸ªæ•°æ®ï¼š`mget key1 key2`
- è·å–æ•°æ®å­—ç¬¦ä¸²ä¸ªæ•°ï¼ˆå­—ç¬¦ä¸²é•¿åº¦ï¼‰ï¼š`strlen key`
- è¿½åŠ ä¿¡æ¯åˆ°åŸå§‹ä¿¡æ¯åéƒ¨ï¼ˆå¦‚æœåŸå§‹ä¿¡æ¯å­˜åœ¨å°±è¿½åŠ ï¼Œå¦åˆ™æ–°å»ºï¼‰ï¼š`append key value`

> å•æ•°æ®æ“ä½œå’Œå¤šæ•°æ®æ“ä½œï¼Ÿ

æ¯”å¦‚ï¼šæ“ä½œä¸‰ä¸ªæ•°æ®

- å•æ•°æ®æ“ä½œï¼š3æ¬¡å‘é€ã€3æ¬¡å›å¤ã€è¿è¡Œä¸‰æ¬¡
- å¤šæ•°æ®æ“ä½œï¼š1æ¬¡å‘é€ï¼Œ1æ¬¡å›å¤ï¼Œè¿è¡Œä¸‰æ¬¡

**ç»“è®ºï¼š**æ²¡æœ‰å›ºå®šç»“è®ºï¼Œå¯¹äºå¤šæ•°æ®æ“ä½œï¼Œå¯èƒ½éœ€è¦åˆ‡å‰²

**5ã€Stringç±»å‹æ•°æ®çš„æ‰©å±•æ“ä½œ**

> ä¸šåŠ¡åœºæ™¯ï¼šåˆ†å¸ƒå¼ID
>
> å¯¹äºå¤§å‹ä¼ä¸šçº§åº”ç”¨ï¼Œåˆ†è¡¨æ“ä½œæ˜¯åŸºæœ¬æ“ä½œï¼Œä½¿ç”¨å¤šå¼ è¡¨å­˜å‚¨åŒç±»å‹æ•°æ®ï¼Œä½†æ˜¯å¯¹åº”çš„ä¸»é”®idå¿…é¡»ä¿è¯ç»Ÿä¸€æ€§ï¼Œä¸èƒ½é‡å¤ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**

- è®¾ç½®æ•°å€¼æ•°æ®å¢åŠ æŒ‡å®šèŒƒå›´çš„å€¼

  ```sql
  # åŠ 1
  incr key
  # åŠ æŒ‡å®šæ•°
  incrby key increment
  incrbyfloat key increment
  ```

- è®¾ç½®æ•°å€¼å‡å°‘æŒ‡å®šèŒƒå›´çš„å€¼

  ```sql
  decr key
  decrby key increment
  ```

Stingä½œä¸ºæ•°å€¼æ“ä½œ

- stringåœ¨rediså†…éƒ¨å­˜å‚¨é»˜è®¤å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå½“é‡åˆ°å¢å‡ç±»æ“ä½œincrã€decæ—¶ä¼šè½¬ä¸ºæ•°å€¼å‹è¿›è¡Œè®¡ç®—
- **redisæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œé‡‡ç”¨å•çº¿ç¨‹å¤„ç†æ‰€æœ‰çš„ä¸šåŠ¡ï¼Œå‘½ä»¤ä¸€ä¸ªä¸ªæ‰§è¡Œ**
- æ³¨æ„ï¼šå¦‚æœåŸå§‹æ•°æ®ä¸èƒ½è½¬ä¸ºæ•°å€¼æˆ–è€…è¶…è¶Šäº†æ•°å€¼ä¸Šé™ï¼Œå°±ä¼šæŠ¥é”™

**redisç”¨äºæ§åˆ¶æ•°æ®åº“ä¸»é”®idï¼Œä¸ºæ•°æ®åº“è¡¨ä¸»é”®æä¾›ç”Ÿæˆç­–ç•¥ï¼Œä¿éšœæ•°æ®åº“è¡¨çš„ä¸»é”®å”¯ä¸€æ€§**

> ä¸šåŠ¡åœºæ™¯ï¼šæ§åˆ¶æ—¶æ•ˆæ€§

**è§£å†³æ–¹æ¡ˆ**

- è®¾ç½®æ•°æ®å…·æœ‰æŒ‡å®šçš„ç”Ÿå‘½å‘¨æœŸ

  ```sql
  setex key seconds value
  psetex key milliseconds value
  ```

redisæ§åˆ¶æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šè¿‡æ•°æ®æ˜¯å¦å¤±æ•ˆæ§åˆ¶ä¸šåŠ¡è¡Œä¸ºï¼Œé€‚ç”¨äºæ‰€æœ‰å…·æœ‰æ—¶æ•ˆæ€§é™å®šæ§åˆ¶çš„æ“ä½œ

**6ã€æ³¨æ„äº‹é¡¹**

æ•°æ®æ“ä½œä¸æˆåŠŸçš„åé¦ˆä¸æ­£å¸¸æ“ä½œä¹‹é—´çš„å·®å¼‚

- (integer) 0ï¼šå¤±è´¥
- (integer) 1ï¼šæˆåŠŸ

æ•°æ®æœªè·å–åˆ°

- (nil)ç­‰åŒäºnull

æ•°æ®æœ€å¤§å­˜å‚¨é‡

- 512MB

æ•°å€¼è®¡ç®—æœ€å¤§èŒƒå›´ï¼ˆjavaçš„longæœ€å¤§å€¼ï¼‰

**7ã€ä¸šåŠ¡åœºæ™¯**

> ä¸»é¡µé«˜é¢‘è®¿é—®ä¿¡æ¯æ˜¾ç¤ºæ§åˆ¶ï¼Œä¾‹å¦‚å¾®åšå¤§Vçš„ç²‰ä¸æ•°é‡å’Œå¾®åšæ•°é‡

**è§£å†³æ–¹æ¡ˆ**

- åœ¨redisä¸­ä¸ºå¤§Vç”¨æˆ·è®¾å®šç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ç”¨æˆ·ä¸»é”®å’Œå±æ€§å€¼ä½œä¸ºkeyï¼Œåå°è®¾å®šå®šæ—¶åˆ·æ–°ç­–ç•¥

  ```sql
  eg: user:id:0001:fans 10
  ```

- ä½¿ç”¨jsonå½¢å¼å­˜å‚¨

  ```sql
  eq: user:id:0001 {fans:10}
  ```

**keyçš„è®¾ç½®çº¦å®š**

è¡¨åï¼šä¸»é”®åï¼šä¸»é”®å€¼ï¼šå±æ€§

### hash

1ã€æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå¯¹ä¸€äº›åˆ—å­˜å‚¨çš„æ•°æ®è¿›è¡Œç¼–ç»„ï¼Œå…¸å‹åº”ç”¨å­˜å‚¨å¯¹è±¡ä¿¡æ¯

2ã€éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªé”®å€¼å¯¹æ•°æ®

3ã€hashç±»å‹ï¼šåº•å±‚ä½¿ç”¨å“ˆå¸Œè¡¨ç»“æ„å®ç°æ•°æ®å­˜å‚¨

<img src="https://img-blog.csdnimg.cn/20210417161600331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

**hashå­˜å‚¨ä¼˜åŒ–ï¼š**

- å¦‚æœfieldæ•°é‡è¾ƒå°‘ï¼Œå­˜å‚¨ç»“æ„ä¼˜åŒ–ä¸ºç±»æ•°ç»„ç»“æ„
- å¦‚æœfieldæ•°é‡è¾ƒå¤šï¼Œå­˜å‚¨ç»“æ„ä½¿ç”¨hashmapç»“æ„

4ã€åŸºæœ¬æ“ä½œ

- æ·»åŠ /ä¿®æ”¹æ•°æ®ï¼š`hset key field value`

- è·å–æ•°æ®ï¼š

  ```sql
  hget key field
  hgetall key
  ```

- æ·»åŠ /ä¿®æ”¹å¤šä¸ªæ•°æ®ï¼š`hmset key field1 value1 field2 value2`
- è·å–å¤šä¸ªæ•°æ®ï¼š`hmget key field1 field2`
- è·å–å“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡ï¼š`hlen key`
- è·å–å“ˆå¸Œè¡¨ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šå­—æ®µï¼š`hexists key field`

**5ã€æ‰©å±•æ“ä½œ**

- è·å–å“ˆå¸Œè¡¨æ‰€æœ‰çš„å­—æ®µåæˆ–å­—æ®µå€¼

  ```sql
  hkeys key
  hvals key
  ```

- è®¾ç½®æŒ‡å®šå­—æ®µçš„æ•°å€¼æ•°æ®å¢åŠ æŒ‡å®šèŒƒå›´çš„å€¼

  ```sql
  hincrby key field increment
  hincrbyfloat key field increment
  ```

**6ã€æ³¨æ„äº‹é¡¹**

- hashç±»å‹çš„valueåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²
- æ¯ä¸ªhashå¯ä»¥å­˜å‚¨2^32-1ä¸ª
- hashç±»å‹ååˆ†è´´è¿‘å¯¹è±¡çš„æ•°æ®å­˜å‚¨å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»æ·»åŠ åˆ é™¤å¯¹è±¡å±æ€§ï¼Œä½†æ˜¯ä¸å¯ä»¥æ»¥ç”¨
- hgetallæ“ä½œå¯ä»¥è·å–å…¨éƒ¨å±æ€§ï¼Œå¦‚æœfieldè¿‡å¤šï¼Œéå†æ•ˆç‡ä¼šå¾ˆä½ï¼Œæœ‰å¯èƒ½æˆä¸ºæ•°æ®è®¿é—®ç“¶é¢ˆ

**7ã€åº”ç”¨åœºæ™¯**

> è´­ç‰©è½¦è®¾è®¡å’Œå®ç°

<img src="https://img-blog.csdnimg.cn/20210417162753154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:67%;" />

**ä¸šåŠ¡åˆ†æ**

- æ·»åŠ ã€æµè§ˆã€æ›´æ”¹æ•°é‡ã€åˆ é™¤ã€æ¸…ç©º

**è§£å†³æ–¹æ¡ˆ**

- ç”¨æˆ·idä¸ºkeyï¼Œæ¯ä½å®¢æˆ·åˆ›å»ºä¸€ä¸ªhashå­˜å‚¨ç»“æ„å­˜å‚¨å¯¹åº”çš„è´­ç‰©è½¦ä¿¡æ¯
- å•†å“ç¼–å·ä¸ºfieldï¼Œè´­ä¹°æ•°é‡ä¸ºvalue
- æ·»åŠ å•†å“ï¼šè¿½åŠ å…¨æ–°çš„fieldå’Œæ•°é‡value
- æµè§ˆï¼šéå†hash
- æ›´æ”¹æ•°é‡ï¼šè‡ªå¢/è‡ªå‡ï¼Œè®¾ç½®valueå€¼
- åˆ é™¤å•†å“ï¼šåˆ é™¤field
- æ¸…ç©ºï¼šåˆ é™¤key

**é—®é¢˜ï¼šå½“å‰åªæ˜¯å°†æ•°æ®å­˜å‚¨åˆ°äº†redisä¸­ï¼Œå¹¶æ²¡æœ‰èµ·åˆ°åŠ é€Ÿçš„ä½œç”¨ï¼Œå•†å“ä¿¡æ¯è¿˜éœ€è¦äºŒæ¬¡æŸ¥è¯¢æ•°æ®åº“**

- æ¯æ¡å•†å“è®°å½•ä¿å­˜ä¸ºä¸¤æ¡field
- field1ç”¨äºä¿å­˜è´­ä¹°æ•°é‡
  - å‘½åæ ¼å¼ï¼š`å•†å“idï¼šnums`
  - æ•°æ®ï¼šæ•°å€¼

- field2ç”¨äºä¿å­˜è´­ç‰©è½¦æ˜¾ç¤ºçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡å­—æè¿°ã€å›¾ç‰‡åœ°å€ç­‰
  - å‘½åæ ¼å¼ï¼š`å•†å“idï¼šinfo`
  - æ•°æ®ï¼šjson

```sql
127.0.0.1:6379> hmset 004 g01:nums 100 g01:info {...}                                     
OK                                                                                                                                                            
127.0.0.1:6379> hgetall 004                                                               
1) "g01:nums"                                                                             
2) "100"                                                                                  
3) "g01:info"                                                                             
4) "{...}"                                                                                
127.0.0.1:6379> 
```

**ä¼˜åŒ–ï¼šå•†å“ç›¸åŒï¼Œä¼šå‡ºç°ä¿¡æ¯é‡å¤ï¼Œå¯ä»¥å°†field2ç‹¬ç«‹æˆhash**

```sql
# å¦‚æœkeyä¸­å¯¹åº”çš„fieldæœ‰vlaueï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œæ²¡æœ‰å€¼å°±åŠ è¿›å»
hsetnx key field value
```

> æŠ¢è´­å•†å“

<img src="https://img-blog.csdnimg.cn/2021041716452792.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

è§£å†³æ–¹æ¡ˆï¼š

- ä»¥å•†å®¶idä½œä¸ºkey
- å‚ä¸æŠ¢è´­çš„å•†å“idä½œä¸ºfield
- æ•°é‡ä¸ºvalue
- ä½¿ç”¨é™å€¼çš„æ–¹å¼æ§åˆ¶



> Stringå­˜å¯¹è±¡ï¼ˆjsonï¼‰ã€Hashå­˜å¯¹è±¡

Stringè¯»ä¸ºä¸»ï¼ŒHashæ›´æ–°ä¸ºä¸»



### list

1ã€æ•°æ®å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤šä¸ªæ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›å…¥å­˜å‚¨ç©ºé—´çš„é¡ºåºè¿›è¡ŒåŒºåˆ†

2ã€éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œä¸”é€šè¿‡æ•°æ®å¯ä»¥ä½“ç°è¿›å…¥é¡ºåº

3ã€listç±»å‹ï¼š**ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œåº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨å®ç°**

**4ã€åŸºæœ¬æ“ä½œ**

- æ·»åŠ æ•°æ®/ä¿®æ”¹æ•°æ®

  ```sql
  lpush key value1 [value2]...
  rpush key value1 [value2]...
  ```

- è·å–æ•°æ®

  ```sql
  lrange key start stop    (lrange list1 0 -1)   
  lindex key index
  llen key
  ```

- è·å–å¹¶ç§»é™¤æ•°æ®

  ```sql
  lpop key
  rpop key
  ```

**5ã€æ‰©å±•æ“ä½œ**

- è§„å®šæ—¶é—´å†…è·å–å¹¶ç§»é™¤æ•°æ®ï¼Œé˜»å¡å¼æ•°æ®è·å–

  ```sql
  blpop key1 [key2] timeout
  brpop key1 [key2] timeout
  ```

> ä¸šåŠ¡åœºæ™¯ï¼šå¾®ä¿¡æœ‹å‹åœˆç‚¹èµï¼Œè¦æ±‚æŒ‰ç…§ç‚¹èµé¡ºåºæ˜¾ç¤ºç‚¹èµå¥½å‹ä¿¡æ¯

<img src="https://img-blog.csdnimg.cn/20210417170350860.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

**ä»ä¸­é—´å–æ¶ˆå…ƒç´ ï¼Œç§»é™¤æŒ‡å®šå…ƒç´ **

```sql
lrem key count value

ä¾‹å­ï¼š
lrem list01 1 d
```

**6ã€æ³¨æ„äº‹é¡¹**

- listä¸­ä¿å­˜çš„æ•°æ®æ˜¯stringç±»å‹
- å…·æœ‰ç´¢å¼•æ¦‚å¿µï¼Œä½†æ˜¯æ“ä½œæ•°æ®é€šå¸¸ä»¥é˜Ÿåˆ—å½¢å¼è¿›è¡Œå…¥é˜Ÿå‡ºé˜Ÿï¼Œæˆ–è€…æ ˆçš„å½¢å¼
- listå¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†é¡µæ“ä½œï¼Œé€šå¸¸ç¬¬ä¸€é¡µä¿¡æ¯æ¥è‡ªlistï¼Œç¬¬2é¡µåŠæ›´å¤šä¿¡æ¯é€šè¿‡æ•°æ®åº“å½¢å¼åŠ è½½

**7ã€ä¸šåŠ¡åœºæ™¯**

> ä¸ªäººç”¨æˆ·çš„å…³æ³¨åˆ—è¡¨éœ€è¦æŒ‰ç…§ç”¨æˆ·çš„å…³æ³¨é¡ºåºè¿›è¡Œå±•ç¤ºï¼Œç²‰ä¸åˆ—è¡¨éœ€è¦é™æœ€è¿‘å…³æ³¨çš„ç²‰ä¸åˆ—åœ¨å‰é¢
>
> æ–°é—»ç½‘ç«™å°†æ–°é—»æŒ‰ç…§å‘ç”Ÿæ—¶é—´é¡ºåºå±•ç¤º
>
> ä¿éšœå¤šå°æœåŠ¡å™¨æ“ä½œæ—¥å¿—çš„ç»Ÿä¸€é¡ºåºè¾“å‡º

è§£å†³æ–¹æ¡ˆï¼š

- ä¾èµ–listçš„æ•°æ®å…·æœ‰é¡ºåºçš„ç‰¹å¾å¯¹ä¿¡æ¯è¿›è¡Œç®¡ç†
- **ä½¿ç”¨é˜Ÿåˆ—æ¨¡å‹è§£å†³å¤šè·¯ä¿¡æ¯æ±‡æ€»åˆå¹¶çš„é—®é¢˜**
- **ä½¿ç”¨æ ˆæ¨¡å‹è§£å†³æœ€æ–°æ¶ˆæ¯çš„é—®é¢˜**

### set

> æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤§é‡æ•°æ®ï¼Œåœ¨æŸ¥è¯¢æ–¹é¢æä¾›æ›´é«˜çš„æ•ˆç‡
>
> éœ€è¦æ–°çš„å­˜å‚¨ç»“æ„ï¼šèƒ½å¤Ÿä¿å­˜å¤§é‡çš„æ•°æ®ï¼Œé«˜æ•ˆçš„å†…éƒ¨å­˜å‚¨æœºåˆ¶ï¼Œä¾¿äºæŸ¥è¯¢
>
> setç±»å‹ï¼šä¸hashå­˜å‚¨ç»“æ„å®Œå…¨ç›¸åŒï¼Œä»…å­˜å‚¨é”®ï¼Œä¸å­˜å‚¨å€¼ï¼Œä¸”å€¼ä¸å…è®¸é‡å¤

<img src="https://img-blog.csdnimg.cn/20210417171747798.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

**1ã€åŸºæœ¬æ“ä½œ**

- æ·»åŠ æ•°æ®

  ```sql
  sadd key m1 m2...
  ```

- è·å–å…¨éƒ¨æ•°æ®

  ```sql
  smembers key
  ```

- åˆ é™¤æ•°æ®

  ```sql
  srem key m1 m2
  ```

- è·å–é›†åˆæ•°æ®æ€»é‡

  ```sql
  scard key
  ```

- åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šæ•°æ®

  ```sql
  sismember key member
  ```

**2ã€æ‰©å±•æ“ä½œ**

> æ¯ä½ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨ä»Šæ—¥å¤´æ¡ä¼šè®¾ç½®3ä¸ªçˆ±å¥½çš„å†…å®¹ï¼ŒåæœŸä¸ºäº†å¢åŠ ç”¨æˆ·çš„æ´»è·ƒåº¦ï¼Œéœ€è¦è®©ç”¨æˆ·å¯¹å…¶ä»–ä¿¡æ¯ç±»åˆ«é€æ¸äº§ç”Ÿå…´è¶£ï¼Œå¦‚ä½•å®ç°ï¼Ÿ

ä¸šåŠ¡åˆ†æ

- ç³»ç»Ÿåˆ†æå‡ºå„ä¸ªåˆ†ç±»çš„æœ€æ–°æˆ–æœ€çƒ­ç‚¹ä¿¡æ¯æ¡ç›®å¹¶ç»„ç»‡æˆseté›†åˆ
- éšæœºæŒ‘é€‰å…¶ä¸­éƒ¨åˆ†ä¿¡æ¯
- é…åˆç”¨æˆ·å…³æ³¨ä¿¡æ¯åˆ†ç±»ä¸­çš„çƒ­ç‚¹ä¿¡æ¯ç»„ç»‡æˆå±•ç¤ºçš„å…¨ä¿¡æ¯é›†åˆ

è§£å†³æ–¹æ¡ˆ

- éšæœºè·å–é›†åˆä¸­æŒ‡å®šæ•°é‡çš„æ•°æ®

  ```sql
  srandmember key count
  ```

- éšæœºè·å–é›†åˆä¸­æŸä¸ªæ•°æ®å¹¶å°†æ•°æ®ç§»å‡ºé›†åˆ

  ```sql
  spop key
  ```

**éšæœºæ¨èç±»ä¿¡æ¯æ£€ç´¢ï¼Œå¦‚çƒ­ç‚¹æ­Œå•æ¨è**

> qqå¥½å‹æ¨èï¼ˆå…±åŒå¥½å‹ï¼‰ã€å¾®åšæ¨è

è§£å†³æ–¹æ¡ˆ

- æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤ã€å¹¶ã€å·®

  ```sql
  sinter key1 key2
  sunion key1 key2
  sdiff key1 key2
  ```

- æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤ã€å¹¶ã€å·®å¹¶å­˜å‚¨åˆ°æŒ‡å®šé›†åˆ

  ```sql
  sinterstore targetkey key1 key2
  sunionstore targetkey key1 key2
  sdiffstore targetkey key1 key2
  ```

- å°†æŒ‡å®šæ•°æ®ä»åŸå§‹é›†åˆç§»åŠ¨åˆ°ç›®æ ‡é›†åˆ

  ```sql
  smove source targetkey member
  ```

**redisåº”ç”¨äºåŒç±»ä¿¡æ¯çš„å…³è”æœç´¢ï¼ŒäºŒåº¦å…³è”æœç´¢ã€æ·±åº¦å…³è”æœç´¢**

**æ˜¾ç¤ºå…±åŒå¥½å‹ã€å…±åŒå…³æ³¨**

3ã€æ³¨æ„äº‹é¡¹

- setç±»å‹ä¸å…è®¸æ•°æ®é‡å¤
- setè™½ç„¶å’Œhashå­˜å‚¨ç»“æ„ç›¸åŒï¼Œæ— æ³•å¯ç”¨hashä¸­çš„å­˜å‚¨å€¼çš„ç©ºé—´

4ã€åº”ç”¨åœºæ™¯

> é›†å›¢æœ‰1000åå‘˜å·¥ï¼Œå†…éƒ¨ç³»ç»Ÿæœ‰700å¤šä¸ªè§’è‰²ï¼Œ3000å¤šä¸ªä¸šåŠ¡æ“ä½œï¼Œ23000å¤šç§æ•°æ®æ¯ä½å‘˜å·¥å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²ï¼Œå¦‚ä½•è¿›è¡Œæƒé™æ ¡éªŒï¼Ÿ

è§£å†³æ–¹æ¡ˆï¼š

- æ ¹æ®ç”¨æˆ·idè·å–ç”¨æˆ·æ‰€æœ‰è§’è‰²
- æ ¹æ®ç”¨æˆ·æ‰€æœ‰è§’è‰²è·å–ç”¨æˆ·æ‰€æœ‰æ“ä½œæƒé™æ”¾å…¥seté›†åˆï¼ˆåˆå¹¶å¹¶å­˜å‚¨ï¼‰
- æ ¹æ®ç”¨æˆ·æ‰€æœ‰è§’è‰²è·å–ç”¨æˆ·æ‰€æœ‰æ•°æ®å…¨é€‰æ”¾å…¥seté›†åˆ

> ç»Ÿè®¡ç½‘ç«™çš„PVï¼ˆè®¿é—®é‡ï¼‰ã€UVï¼ˆç‹¬ç«‹è®¿å®¢ï¼‰ã€IPï¼ˆç‹¬ç«‹IPï¼‰
>
> PVï¼šè¢«è®¿é—®çš„æ¬¡æ•°
>
> UVï¼šä¸åŒç”¨æˆ·è®¿é—®æ¬¡æ•°
>
> IPï¼šä¸åŒIPåœ°å€è®¿é—®æ¬¡æ•°

è§£å†³æ–¹æ¡ˆï¼š

- å»ºç«‹stringç±»å‹æ•°æ®ï¼Œåˆ©ç”¨incrç»Ÿè®¡æ—¥è®¿é—®é‡ï¼ˆPVï¼‰
- å»ºç«‹setæ¨¡å‹ï¼Œè®°å½•ä¸åŒcookieæ•°é‡ï¼ˆUVï¼‰
- å»ºç«‹setæ¨¡å‹ï¼Œè®°å½•ä¸åŒipæ•°é‡ï¼ˆIPï¼‰

> é»‘ç™½åå•

è§£å†³æ–¹æ¡ˆï¼š

- å‘¨æœŸæ€§æ›´æ–°ç”¨æˆ·é»‘åå•ï¼ŒåŠ å…¥seté›†åˆ
- ç”¨æˆ·è¡Œä¸ºä¿¡æ¯åˆ°è¾¾åå’Œé»‘åå•è¿›è¡Œæ¯”å¯¹ï¼Œç¡®è®¤è¡Œä¸ºå»å‘
- é»‘åå•è¿‡æ»¤IPåœ°å€ï¼šåº”ç”¨äºå¼€æ”¾æ¸¸å®¢è®¿é—®æƒé™çš„ä¿¡æ¯æº
- é»‘åå•è¿‡æ»¤è®¾å¤‡ä¿¡æ¯ï¼šåº”ç”¨äºé™å®šè®¿é—®è®¾å¤‡çš„ä¿¡æ¯æº
- é»‘åå•è¿‡æ»¤ç”¨æˆ·ï¼šåº”ç”¨äºåŸºäºè®¿é—®æƒé™çš„ä¿¡æ¯æº



### zset

> æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šæ•°æ®æ’åºæœ‰åˆ©äºæ•°æ®æœ‰æ•ˆå±•ç¤ºï¼Œéœ€è¦æä¾›ä¸€ç§å¯ä»¥æ ¹æ®è‡ªèº«ç‰¹å¾è¿›è¡Œæ’åºçš„æ–¹å¼
>
> éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šæ–°çš„å­˜å‚¨æ¨¡å‹ï¼Œå¯ä»¥ä¿å­˜å¯æ’åºçš„æ•°æ®
>
> zsetç±»å‹ï¼šåœ¨setçš„å­˜å‚¨ç»“æ„åŸºç¡€ä¸Šæ·»åŠ å¯æ’åºå­—æ®µ score



<img src="https://img-blog.csdnimg.cn/20210417175132505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />





**1ã€åŸºæœ¬æ“ä½œ**

- æ·»åŠ æ•°æ®

  ```sql
  zadd key score1 m1 score2 m2
  ```

- è·å–å…¨éƒ¨æ•°æ®ï¼Œå·²ç»æ’åº

  ```sql
  # ä»å°åˆ°å¤§
  zrange key start stop ã€withscoresã€‘
  # ä»å¤§åˆ°å°
  zrevrange key start stop ã€withscoresã€‘
  ```

- åˆ é™¤æ•°æ®

  ```sql
  zrem key m1 m2 m3...
  ```

- æŒ‰æ¡ä»¶è·å–æ•°æ®

  ```sql
  zrangebyscore key min max [withscores][limit]
  zrevrangebyscore key max min [withscores]
  ```

- æ¡ä»¶åˆ é™¤æ•°æ®

  ```sql
  zremrangebyrank key start stop
  zremrangebyscore key min max
  ```

- è·å–é›†åˆæ•°æ®æ€»é‡

  ```sql
  zcard key
  zcount key min max
  ```

- é›†åˆäº¤ã€å¹¶æ“ä½œ

  ```sql
  zinterstore target numkeys key1 key2
  zunionstore target numkeys key1 key2
  ```

**2ã€æ‰©å±•æ“ä½œ**

> ç”µå½±TOP10
>
> - å¯¹èµ„æºå»ºç«‹æ’åºä¾æ®

è§£å†³æ–¹æ¡ˆ

- è·å–æ•°æ®å¯¹åº”çš„ç´¢å¼•ï¼ˆæ’åï¼‰

  ```sql
  zrank key member
  zrevrank key member
  ```

- scoreå€¼è·å–ä¸ä¿®æ”¹

  ```sql
  zscore key member
  zincrby key increment member
  ```

3ã€æ³¨æ„äº‹é¡¹

- scoreæœ‰èŒƒå›´ï¼Œ64ä½
- scoreä¿å­˜çš„æ•°æ®å¯ä»¥æ˜¯ä¸€ä¸ªåŒç²¾åº¦doubleå€¼ï¼ŒåŸºäºåŒç²¾åº¦æµ®ç‚¹æ•°çš„ç‰¹å¾å¯èƒ½ä¼šä¸¢å¤±ç²¾åº¦ï¼Œä½¿ç”¨æ—¶è¦æ…é‡
- **zsetåº•å±‚å­˜å‚¨è¿˜æ˜¯åŸºäºsetç»“æ„ï¼Œå› æ­¤æ•°æ®ä¸èƒ½é‡å¤ï¼Œå¦‚æœé‡å¤æ·»åŠ ç›¸åŒæ•°æ®ï¼Œscoreä¼šè¢«è¦†ç›–ï¼Œä¿ç•™æœ€åä¸€æ¬¡ä¿®æ”¹çš„ç»“æœ**

**4ã€åº”ç”¨åœºæ™¯**

> åŸºäºæ—¶æ•ˆæ€§ä»»åŠ¡ç®¡ç†
>
> è¯•ç”¨VIPï¼ŒVIPåˆ°æœŸä¹‹åï¼Œå¦‚æœæœ‰æ•ˆç®¡ç†æ­¤ç±»ä¿¡æ¯ï¼Œå³ä¾¿å¯¹äºæ­£å¼VIPç”¨æˆ·ä¹Ÿå­˜åœ¨å¯¹åº”çš„ç®¡ç†æ–¹å¼

è§£å†³æ–¹æ¡ˆ

- å°†å¤„ç†æ—¶é—´è®°å½•ä¸ºscoreå€¼
- è®°å½•ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„æ—¶é—´ï¼Œå½“åˆ°æœŸåå¤„ç†å¯¹åº”ä»»åŠ¡ï¼Œç§»é™¤redisä¸­çš„è®°å½•ï¼Œè®°å½•ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„æ—¶é—´
- æ–°ä»»åŠ¡åŠ å…¥æ—¶ï¼Œåˆ¤å®šå¹¶æ›´æ–°å½“å‰ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„ä»»åŠ¡æ—¶é—´
- ä¸ºäº†æå‡æ€§èƒ½ï¼Œé€šå¸¸å°†ä»»åŠ¡æ ¹æ®ç‰¹å¾å­˜å‚¨æˆè‹¥å¹²ä¸ªzsetï¼Œä¾‹å¦‚1å°æ—¶å†…ã€1å¤©å†…ç­‰ï¼Œæ“ä½œæ—¶é€çº§æå‡ï¼Œå°†å³å°†æ“ä½œçš„è‹¥å¹²ä¸ªä»»åŠ¡çº³å…¥1å°æ—¶å†…å¤„ç†çš„é˜Ÿåˆ—ä¸­
- è·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š`time`

> æƒé‡ä»»åŠ¡é˜Ÿåˆ—/æ¶ˆæ¯é˜Ÿåˆ—

è§£å†³æ–¹æ¡ˆ

- å¯¹äºå¸¦æƒé‡çš„ä»»åŠ¡ï¼Œä¼˜å…ˆå¤„ç†æƒé‡é«˜çš„ä»»åŠ¡ï¼Œé‡‡ç”¨scoreè®°å½•æƒé‡

**å¤šæ¡ä»¶ä»»åŠ¡æƒé‡**

- å¦‚æœæƒé™è¿‡å¤šï¼Œéœ€è¦å¯¹æ’åºscoreå€¼è¿›è¡Œå¤„ç†

### æ¡ˆä¾‹

> å¾®ä¿¡æ¥æ”¶æ¶ˆæ¯é»˜è®¤å°†æœ€è¿‘æ¥æ”¶çš„æ¶ˆæ¯ç½®é¡¶ï¼Œå¤šä¸ªå¥½å‹åŠè®¢é˜…å·åŒæ—¶å‘æ¶ˆæ¯ï¼Œè¯¥æ’åºä¼šä¸åœè¿›è¡Œäº¤æ›¿ï¼ŒåŒæ—¶è¿˜å¯ä»¥å°†é‡è¦çš„ä¼šè¯è®¾ç½®ä¸ºç½®é¡¶ï¼Œä¸€æ—¦ç”¨æˆ·ç¦»çº¿åï¼Œå†æ¬¡æ‰“å¼€å¾®ä¿¡æ—¶æ¶ˆæ¯æ€ä¹ˆæŒ‰é¡ºåºå±•ç¤ºï¼Ÿ

ä¾èµ–listçš„æ•°æ®å…·æœ‰é¡ºåºçš„ç‰¹å¾

å¯¹ç½®é¡¶å¥½å‹å’Œæ™®é€šå¥½å‹åˆ†åˆ«åˆ›å»ºç‹¬ç«‹çš„list

å½“æŸä¸ªlistæ¥å—åˆ°ç”¨æˆ·æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯å‘é€æ–¹çš„idä»listçš„ä¸€ä¾§åŠ å…¥list

å¤šä¸ªç›¸åŒidåŠ å…¥éœ€è¦å…ˆåˆ é™¤

å…ˆæ¨é€ç½®é¡¶ä¼šè¯list



## ğŸ˜Š é€šç”¨å‘½ä»¤

### keyé€šç”¨å‘½ä»¤

#### keyç‰¹å¾

1ã€keyæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡keyè·å–redisä¿å­˜çš„æ•°æ®

> keyåº”è¯¥è®¾è®¡å“ªäº›æ“ä½œï¼Ÿ

å¯¹äºkeyè‡ªèº«çŠ¶æ€ç›¸å…³æ“ä½œ

å¯¹äºkeyæœ‰æ•ˆæ€§æ§åˆ¶ç›¸å…³æ“ä½œ

å¯¹äºkeyå¿«é€ŸæŸ¥è¯¢

#### keyåŸºæœ¬æ“ä½œ

1ã€åˆ é™¤æŒ‡å®škey

```sql
del key
```

2ã€è·å–keyæ˜¯å¦å­˜åœ¨

```sql
exists key
```

3ã€è·å–keyç±»å‹

```sql
type key
```

#### keyæ‰©å±•æ“ä½œï¼ˆæ—¶æ•ˆæ€§ï¼‰

1ã€ä¸ºæŒ‡å®škeyè®¾ç½®æœ‰æ•ˆæœŸ

```sql
expire key seconds
pexpire key milliseconds
expireat key timestamp
pexpireat key milliseconds-timestamp
```

2ã€è·å–keyæœ‰æ•ˆæœŸ

- -2ï¼šä¸å­˜åœ¨
- -1ï¼šå­˜åœ¨
- å½“å‰æœ‰æ•ˆæ—¶é•¿

```sql
ttl key
pttl key
```

3ã€åˆ‡æ¢keyè½¬æ¢åˆ°æ°¸ä¹…æ€§

```sql
persist key
```

#### keyæ‰©å±•æ“ä½œï¼ˆæŸ¥è¯¢æ¨¡å¼ï¼‰

1ã€æŸ¥è¯¢key

- `Keys *` æŸ¥è¯¢ç´¢å¼•
- `Keys it*` æŸ¥è¯¢æ‰€æœ‰ä»¥itå¼€å¤´çš„
- `keys ??h` æŸ¥è¯¢å‰é¢ä¸¤ä¸ªå­—ç¬¦ä»»æ„ï¼Œåé¢ä»¥hç»“å°¾
- `keys user:?` æŸ¥è¯¢æ‰€æœ‰ä»¥userï¼šå¼€å¤´ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä»»æ„

```sql
keys pattern
```

#### keyå…¶ä»–æ“ä½œ

1ã€ä¸ºkeyæ”¹åå­—

```sql
# åŒåå°±è¦†ç›–
rename key newkey
# å¦‚æœä¸å­˜åœ¨æ”¹å
renamenx key newkey
```

2ã€å¯¹æ‰€æœ‰keyæ’åº

```sql
sort
```

3ã€å…¶ä»–key é€šç”¨æ“ä½œ

```sql
help @generic
```

### æ•°æ®åº“é€šç”¨å‘½ä»¤

> keyé‡å¤é—®é¢˜

1ã€åˆ‡æ¢æ•°æ®åº“

```sql
select index
```

2ã€å…¶ä»–æ“ä½œ

```sql
quit
ping 
echo message
```

3ã€æ•°æ®ç§»åŠ¨

```sql
move key db_index
```

## ğŸ˜Š Jedis

```java
public void testJedis(){
  //1ã€è¿æ¥redis
  Jedis jedis = new Jedis("192.168.164.134",6379);
  //2ã€æ“ä½œredis
  jedis.select(2);
  jedis.set("name","zhang");
  System.out.println(jedis.get("name"));
  //3ã€å…³é—­è¿æ¥
  jedis.close();
}
```



## ğŸ˜Š æŒä¹…åŒ–

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210417214135821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70)

> ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿ

æŒä¹…åŒ–ï¼šåˆ©ç”¨æ°¸ä¹…æ€§å­˜å‚¨ä»‹è´¨å°†æ•°æ®è¿›è¡Œä¿å­˜ï¼Œåœ¨ç‰¹å®šçš„æ—¶é—´å°†ä¿å­˜çš„æ•°æ®è¿›è¡Œæ¢å¤çš„å·¥ä½œæœºåˆ¶

> ä¸ºä»€ä¹ˆè¦è¿›è¡ŒæŒä¹…åŒ–ï¼Ÿ

é˜²æ­¢æ•°æ®çš„æ„å¤–ä¸¢å¤±ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

> æŒä¹…åŒ–è¿‡ç¨‹ä¿å­˜ä»€ä¹ˆï¼Ÿ

1ã€RDBï¼šå°†å½“å‰æ•°æ®çŠ¶æ€è¿›è¡Œä¿å­˜ï¼Œ**å¿«ç…§å½¢å¼**ï¼Œå­˜å‚¨æ•°æ®ç»“æœï¼Œå­˜å‚¨æ ¼å¼ç®€å•ï¼Œå…³æ³¨ç‚¹åœ¨æ•°æ®

2ã€AOFï¼šå°†æ•°æ®çš„æ“ä½œè¿‡ç¨‹è¿›è¡Œä¿å­˜ï¼Œ**æ—¥å¿—å½¢å¼**ï¼Œå­˜å‚¨æ“ä½œè¿‡ç¨‹ï¼Œå­˜å‚¨æ ¼å¼å¤æ‚ï¼Œå…³æ³¨ç‚¹åœ¨æ•°æ®çš„æ“ä½œè¿‡ç¨‹

### RDB

> è°ï¼Ÿä»€ä¹ˆæ—¶é—´ï¼Ÿå¹²ä»€ä¹ˆäº‹æƒ…ï¼Ÿ

- è°ï¼šredisæ“ä½œè€…
- ä»€ä¹ˆæ—¶é—´ï¼šå³æ—¶
- å¹²ä»€ä¹ˆäº‹æƒ…ï¼šä¿å­˜æ•°æ®

#### saveã€bgsave

1ã€å‘½ä»¤ï¼š

```sql
save
```



<img src="https://img-blog.csdnimg.cn/20210417214829822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

2ã€saveæŒ‡ä»¤ç›¸å…³é…ç½®

<img src="https://img-blog.csdnimg.cn/20210417214936359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

3ã€saveå·¥ä½œåŸç†

**saveæŒ‡ä»¤ä¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨**

> æ•°æ®é‡è¿‡å¤§ï¼Œå•çº¿ç¨‹æ‰§è¡Œæ–¹å¼é€ æˆæ•ˆç‡è¿‡ä½å¦‚ä½•å¤„ç†ï¼Ÿ

**åå°æ‰§è¡Œ**

- è°ï¼šä½¿ç”¨è€…
- ä»€ä¹ˆæ—¶é—´ï¼šåˆç†çš„æ—¶é—´
- å¹²ä»€ä¹ˆäº‹ï¼šä¿å­˜æ•°æ®

1ã€å‘½ä»¤

```sql
bgsave
```

2ã€ä½œç”¨

æ‰‹åŠ¨å¯åŠ¨åå°ä¿å­˜æ“ä½œï¼Œä½†æ˜¯ä¸æ˜¯ç«‹å³æ‰§è¡Œçš„

```sql
127.0.0.1:6379> bgsave                                                                    
Background saving started 
```

3ã€å·¥ä½œåŸç†

<img src="https://img-blog.csdnimg.cn/2021041722000451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

**bgsaveæ˜¯é’ˆå¯¹saveé˜»å¡é—®é¢˜åšçš„ä¼˜åŒ–ï¼ŒRediså†…éƒ¨æ‰€æ¶‰åŠçš„RDBæ“ä½œéƒ½é‡‡ç”¨bgsaveæ–¹å¼**

#### è‡ªåŠ¨æ‰§è¡Œ

> åå¤æ‰§è¡Œä¿å­˜æŒ‡ä»¤ï¼Œå¿˜è®°äº†æ€ä¹ˆåŠï¼Ÿä¸çŸ¥é“æ•°æ®äº§ç”Ÿäº†å¤šå°‘å˜åŒ–ï¼Ÿä½•æ—¶ä¿å­˜ï¼Ÿ

**è‡ªåŠ¨æ‰§è¡Œ**

- è°ï¼šredisæœåŠ¡å™¨å‘èµ·æŒ‡ä»¤ï¼ˆåŸºäºæ¡ä»¶ï¼‰
- ä»€ä¹ˆæ—¶é—´ï¼šæ»¡è¶³æ¡ä»¶
- å¹²ä»€ä¹ˆäº‹æƒ…ï¼šä¿å­˜æ•°æ®

1ã€é…ç½®

```sql
save second changes
```

ä½œç”¨ï¼šæ»¡è¶³é™å®šæ—¶é—´èŒƒå›´å†…ï¼ˆsecondï¼‰keyçš„å˜åŒ–æ•°é‡è¾¾åˆ°æŒ‡å®šæ•°é‡ï¼ˆchangesï¼‰å³è¿›è¡ŒæŒä¹…åŒ–

2ã€å·¥ä½œåŸç†

4ã€åŸç†

<img src="https://img-blog.csdnimg.cn/20210417220936467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

saveé…ç½®è¦æ ¹æ®å®é™…ä¸šåŠ¡è®¾ç½®ï¼Œéšæ„è®¾ç½®ä¼šå‡ºç°é—®é¢˜

ä½¿ç”¨çš„æ˜¯bgsave

#### å¯¹æ¯”

<img src="https://img-blog.csdnimg.cn/20210418100055166.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

#### ä¼˜ç‚¹å’Œç¼ºç‚¹

1ã€ä¼˜ç‚¹

- å­˜å‚¨æ•ˆç‡é«˜
- å†…éƒ¨å­˜å‚¨çš„æ˜¯redisåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¿«ç…§
- **é€Ÿåº¦æ¯”AOFå¿«**
- åº”ç”¨ï¼šæœåŠ¡å™¨ä¸­æ¯Xä¸ªå°æ—¶æ‰§è¡Œbgsaveå¤‡ä»½ï¼Œå°†rdbæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸­ï¼Œ**ç”¨äºç¾éš¾æ¢å¤**

2ã€ç¼ºç‚¹

- æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–ï¼Œå…·æœ‰è¾ƒå¤§å¯èƒ½ä¸¢å¤±æ•°æ®
- bgsaveéœ€è¦forkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œè¦ç‰ºç‰²ä¸€äº›æ€§èƒ½
- redisä¼—å¤šç‰ˆæœ¬æ²¡æœ‰è¿›è¡Œrdbçš„æ ¼å¼ç»Ÿä¸€ï¼Œå¯èƒ½å‡ºç°å…¼å®¹é—®é¢˜

### AOF

> RDBçš„å¼Šç«¯ï¼š
>
> - æ•°æ®é‡å¤§ï¼Œæ•ˆç‡ä½ã€IOæ€§èƒ½ä½
> - åŸºäºforkåˆ›å»ºå­è¿›ç¨‹ï¼Œå†…å­˜äº§ç”Ÿé¢å¤–æ¶ˆè€—
> - å®•æœºå¸¦æ¥çš„æ•°æ®ä¸¢å¤±é£é™©
>
> è§£å†³æ€è·¯
>
> - ä¸å†™å…¨æ•°æ®ï¼Œä»…è®°å½•éƒ¨åˆ†æ•°æ®
> - æ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ“ä½œè¿‡ç¨‹
> - å¯¹æ‰€æœ‰æ“ä½œå‡è¿›è¡Œè®°å½•ï¼Œæ’é™¤ä¸¢å¤±æ•°æ®çš„é£é™©

1ã€AOFæ¦‚å¿µï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFä¸­å‘½ä»¤æ¥æ¢å¤æ•°æ®ï¼Œä¸RDBç›¸æ¯”å¯ä»¥ç®€å•æè¿°ä¸º**æ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ“ä½œè¿‡ç¨‹**

2ã€ä¸»è¦ä½œç”¨ï¼šè§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯RedisæŒä¹…åŒ–çš„ä¸»æµæ–¹å¼

#### å†™æ•°æ®çš„è¿‡ç¨‹

<img src="https://img-blog.csdnimg.cn/20210418093029908.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

ä¸‰ä¸ªå†™æ•°æ®çš„ç­–ç•¥

- **always**ï¼šæ¯æ¬¡å†™å…¥æ“ä½œå‡åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œ**æ•°æ®é›¶è¯¯å·®ï¼Œæ€§èƒ½è¾ƒä½**
- **everysec**ï¼šæ¯ç§’å°†ç¼“å†²åŒºçš„æŒ‡ä»¤åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œæ•°æ®**å‡†ç¡®æ€§è¾ƒé«˜ï¼Œæ€§èƒ½è¾ƒé«˜**ï¼Œåœ¨ç³»ç»Ÿçªç„¶å®•æœºçš„æƒ…å†µä¸‹ä¸¢å¤±1sçš„æ•°æ®
- **no**ï¼šæ“ä½œç³»ç»Ÿæ§åˆ¶æ¯æ¬¡åŒæ­¥åˆ°AOFæ–‡ä»¶çš„å‘¨æœŸï¼Œ**è¿‡ç¨‹ä¸å¯æ§åˆ¶**

4ã€AOFåŠŸèƒ½å¼€å¯

- é…ç½®ï¼šå¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½

```sql
appendonly yes
```

- é…ç½®ï¼šAOFå†™æ•°æ®ç­–ç•¥

```sql
appendfsync always|everysec|no
```

#### AOFé‡å†™

éšç€å‘½ä»¤ä¸æ–­å†™å…¥AOFï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRediså¼•å…¥äº†AOFé‡å†™æœºåˆ¶å‹ç¼©æ–‡ä»¶ä½“ç§¯ï¼ŒAOFæ–‡ä»¶é‡å†™æ˜¯å°†Redisè¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤åŒæ­¥åˆ°æ–°AOFæ–‡ä»¶çš„è¿‡ç¨‹ã€‚

**ç®€å•çš„è¯´ï¼Œå°±æ˜¯å°†åŒä¸€ä¸ªæ•°æ®çš„è‹¥å¹²ä¹°äº†æ‰§è¡Œç»“æœè½¬åŒ–ä¸ºæœ€ç»ˆç»“æœæ•°æ®å¯¹åº”çš„æŒ‡ä»¤è¿›è¡Œè®°å½•**

ä½œç”¨ï¼š

- é™ä½ç£ç›˜å ç”¨é‡
- æé«˜æŒä¹…åŒ–æ•ˆç‡
- é™ä½æ¢å¤æ•°æ®çš„æ•ˆç‡

è§„åˆ™ï¼š

- è¿›ç¨‹å†…å·²è¶…æ—¶çš„æ•°æ®ä¸å†å†™å…¥æ–‡ä»¶
- å¿½ç•¥æ— æ•ˆæŒ‡ä»¤ï¼Œé‡å†™æ—¶ä½¿ç”¨è¿›ç¨‹å†…æ•°æ®ç›´æ¥ç”Ÿæˆï¼Œæ–°çš„AOFåªä¿ç•™æœ€ç»ˆæ•°æ®çš„å†™å…¥å‘½ä»¤
- å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¡å‘½ä»¤è¿›è¡Œåˆå¹¶

æ–¹å¼ï¼š

- æ‰‹åŠ¨

```sql
bgrewriteaof
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210418094753542.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70)

- è‡ªåŠ¨ï¼ˆé…ç½®ï¼‰

```sql
auto-aof-rewrite-min-size size
auto-aof-rewrite-percentage percent
```

- è‡ªåŠ¨é‡å†™è§¦å‘å¯¹æ¯”å‚æ•°

```sql
aof_current_size
aof_base_size
```

- è‡ªåŠ¨é‡å†™è§¦å‘æ¡ä»¶

```sql
aof_current_size > auto-aof-rewrite-min-size
æˆ–è€…
(aof_current_size - aof_base_size) / aof_base_size >= auto-aof-rewrite-percentage
```

#### AOFå·¥ä½œæµç¨‹

<img src="https://img-blog.csdnimg.cn/20210418095341735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210418095415457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70)



![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210418095415457.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70)





### RDBå’ŒAOFåŒºåˆ«

<img src="https://img-blog.csdnimg.cn/20210418095510742.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />



#### å¦‚ä½•é€‰æ‹©

**1ã€å¯¹æ•°æ®éå¸¸æ•æ„Ÿï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤çš„AOFæŒä¹…åŒ–æ–¹æ¡ˆ**

- AOFæŒä¹…åŒ–ç­–ç•¥ä½¿ç”¨everysecondï¼Œæ¯ç§’é’Ÿfsyncä¸€æ¬¡ï¼Œè¯¥ç­–ç•¥redisä»å¯ä»¥ä¿æŒå¾ˆå¥½çš„å¤„ç†æ€§èƒ½ï¼Œå½“å‡ºç°é—®é¢˜ï¼Œæœ€å¤šä¸¢å¤±1sæ•°æ®
- æ³¨æ„ï¼šAOFæ–‡ä»¶å­˜å‚¨ä½“ç§¯å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢

**2ã€æ•°æ®å‘ˆç°é˜¶æ®µæœ‰æ•ˆæ€§ï¼Œå»ºè®®ä½¿ç”¨RDBæŒä¹…åŒ–æ–¹æ¡ˆ**

- æ•°æ®å¯ä»¥è‰¯å¥½çš„åšåˆ°é˜¶æ®µå†…æ— ä¸¢å¤±ï¼Œä¸”æ¢å¤é€Ÿåº¦è¾ƒå¿«
- æ³¨æ„ï¼šåˆ©ç”¨RDBå®ç°ç´§å‡‘æ•°æ®æŒä¹…åŒ–ä¼šé™ä½Redisæ€§èƒ½

3ã€ç»¼åˆæ¯”å¯¹

- RDBå’ŒAOFæ˜¯ä¸€ç§æƒè¡¡
- **ä¸èƒ½æ‰¿å—åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯¹ä¸šåŠ¡æ•°æ®æ•æ„Ÿï¼Œä½¿ç”¨AOF**
- **èƒ½å¤Ÿæ‰¿å—åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œä¸”è¿½æ±‚å¤§æ•°æ®é›†çš„æ¢å¤é€Ÿåº¦ï¼Œä½¿ç”¨RDB**
- **ç¾éš¾æ¢å¤ä½¿ç”¨RDB**
- åŒä¿é™©ç­–ç•¥ï¼ŒåŒæ—¶å¼€å¯RDBå’ŒAOFï¼Œé‡å¯åRedis**ä¼˜å…ˆä½¿ç”¨AOF**æ¢å¤æ•°æ®

### æŒä¹…åŒ–åº”ç”¨åœºæ™¯

<img src="https://img-blog.csdnimg.cn/20210418100351741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

ä¸éœ€è¦æŒä¹…åŒ–ï¼š1ã€3ã€4ã€9ã€12ï¼ˆé•¿æœŸï¼‰ã€15

æŒä¹…åŒ–ï¼š5ã€6ã€7ã€12ï¼ˆçŸ­æœŸï¼‰ã€13ã€16

## ğŸ˜Š äº‹åŠ¡

### ç®€ä»‹

Redisæ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ï¼Œå¤šæ¡è¿ç»­æ‰§è¡Œçš„æŒ‡ä»¤è¢«å¹²æ‰°ï¼Œæ‰“æ–­ï¼Œæ’é˜Ÿ

> redisäº‹åŠ¡å°±æ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„é˜Ÿåˆ—ï¼Œå°†ä¸€ç³»åˆ—é¢„å®šä¹‰å‘½ä»¤åŒ…è£…æˆä¸€ä¸ªæ•´ä½“ï¼Œå½“æ‰§è¡Œæ—¶ä¸€æ¬¡æ€§æŒ‰ç…§æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸­é—´ä¸ä¼šè¢«æ‰“æ–­æˆ–è€…æ‰“æ‰°

ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤

### åŸºæœ¬æ“ä½œ

1ã€å¼€å¯äº‹åŠ¡

- ä½œç”¨ï¼šè®¾å®šäº‹åŠ¡å¼€å¯ä½ç½®ï¼Œè¯¥æŒ‡ä»¤æ‰§è¡Œåï¼Œåç»­çš„æ‰€æœ‰æŒ‡ä»¤å‡åŠ å…¥äº‹åŠ¡ä¸­

```sql
multi
```

2ã€æ‰§è¡Œäº‹åŠ¡

- ä½œç”¨ï¼šè®¾å®šäº‹åŠ¡çš„ç»“æŸä½ç½®ï¼ŒåŒæ—¶æ‰§è¡Œäº‹åŠ¡ï¼Œä¸multiæˆå¯¹å‡ºç°ï¼Œæˆå¯¹ä½¿ç”¨

```sql
exec
```

ä¾‹å­

```sql
127.0.0.1:6379> multi                                                                     
OK
127.0.0.1:6379> set name lisi                                                             
QUEUED
127.0.0.1:6379> exec                                                                      
1) OK
```

**æ³¨æ„ï¼šåŠ å…¥äº‹åŠ¡çš„å‘½ä»¤æš‚æ—¶è¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ²¡æœ‰ç«‹å³æ‰§è¡Œï¼Œåªæœ‰æ‰§è¡Œexecæ‰å¼€å§‹æ‰§è¡Œ**

3ã€å–æ¶ˆäº‹åŠ¡

- ä½œç”¨ï¼šç»ˆæ­¢å½“å‰äº‹åŠ¡ï¼Œå‘ç”Ÿåœ¨multiä¹‹åï¼Œexecä¹‹å‰

```sql
discard
```

#### å·¥ä½œæµç¨‹

<img src="https://img-blog.csdnimg.cn/20210418103943492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

#### æ³¨æ„äº‹é¡¹

> å®šä¹‰äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤æ ¼å¼è¾“å…¥é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

- è¯­æ³•é”™è¯¯ï¼šæŒ‡ä»¤ä¹¦å†™æ ¼å¼æœ‰è¯¯
- **å¤„ç†ç»“æœï¼šå¦‚æœå®šä¹‰çš„äº‹åŠ¡ä¸­æ‰€åŒ…å«çš„å‘½ä»¤å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæ•´ä½“äº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤å‡ä¸ä¼šæ‰§è¡Œ**

> å®šä¹‰äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤æ‰§è¡Œå‡ºç°é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

- è¿è¡Œé”™è¯¯ï¼šå‘½ä»¤æ ¼å¼æ­£ç¡®ï¼Œä½†æ˜¯æ— æ³•æ­£ç¡®æ‰§è¡Œï¼Œä¾‹å¦‚listè¿›è¡Œincræ“ä½œ
- **å¤„ç†ç»“æœï¼šèƒ½å¤Ÿæ­£ç¡®è¿è¡Œçš„å‘½ä»¤ä¼šæ‰§è¡Œï¼Œè¿è¡Œé”™è¯¯çš„å‘½ä»¤ä¸ä¼šæ‰§è¡Œ**

**æ³¨æ„ï¼šå·²ç»æ‰§è¡Œå®Œæ¯•çš„å‘½ä»¤å¯¹åº”çš„æ•°æ®ä¸ä¼šè‡ªåŠ¨å›æ»šï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±å®ç°å›æ»š**

> æ‰‹åŠ¨å›æ»š

- è®°å½•æ“ä½œè¿‡ç¨‹ä¸­è¢«å½±å“çš„æ•°æ®ä¹‹å‰çš„çŠ¶æ€
  - å•æ•°æ®ï¼šstring
  - å¤šæ•°æ®ï¼šhashã€listã€setã€zset
- è®¾ç½®æŒ‡ä»¤æ¢å¤æ‰€æœ‰çš„è¢«ä¿®æ”¹é¡¹

### é”

> ä¸šåŠ¡åœºæ™¯
>
> å¯¹è´§ç‰©è¿›è¡Œè¡¥è´§ï¼Œ4ä¸ªä¸šåŠ¡å‘˜éƒ½æœ‰æƒé™è¿›è¡Œè¡¥è´§ï¼Œè¡¥è´§æ“ä½œå¯èƒ½æ˜¯ä¸€ç³»åˆ—æ“ä½œï¼Œç‰µæ‰¯åˆ°å¤šä¸ªè¿ç»­æ“ä½œï¼Œå¦‚ä½•ä¿éšœä¸ä¼šé‡å¤æ“ä½œï¼Ÿ
>
> ä¸šåŠ¡åˆ†æ
>
> - å¤šä¸ªå®¢æˆ·ç«¯å¯èƒ½åŒæ—¶æ“ä½œåŒä¸€ç»„æ•°æ®ï¼Œå¹¶ä¸”è¯¥æ•°æ®ä¸€æ—¦è¢«æ“ä½œä¿®æ”¹åï¼Œå°†ä¸é€‚ç”¨äºç»§ç»­æ“ä½œ
> - åœ¨æ“ä½œä¹‹å‰é”å®šè¦æ“ä½œçš„æ•°æ®ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œç»ˆæ­¢å½“å‰æ“ä½œ

**watch**

å¯¹keyæ·»åŠ ç›‘è§†é”ï¼Œåœ¨æ‰§è¡Œexecä¹‹å‰å¦‚æœkeyå‘ç”Ÿå˜åŒ–ï¼Œç»ˆæ­¢äº‹åŠ¡

```sql
watch key1 key2...
```

å–æ¶ˆå¯¹æ‰€æœ‰keyçš„ç›‘è§†

```sql
unwatch
```

### åˆ†å¸ƒå¼é”

> è¶…å–é—®é¢˜ï¼Œé¿å…ä¸€ä»¶å•†å“è¢«å¤šä¸ªäººä¿®æ”¹

ä¸šåŠ¡åˆ†æï¼š

- ä½¿ç”¨watchç›‘æ§ä¸€ä¸ªkeyæœ‰æ²¡æœ‰æ”¹å˜ä¸èƒ½è§£å†³é—®é¢˜ï¼Œéœ€è¦ç›‘æ§çš„æ˜¯å…·ä½“æ•°æ®
- è™½ç„¶redisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯**å¤šä¸ªå®¢æˆ·ç«¯å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼Œå¦‚ä½•é¿å…ä¸è¢«åŒæ—¶ä¿®æ”¹ï¼Ÿ**

è§£å†³æ–¹æ¡ˆ

- **ä½¿ç”¨setnxè®¾ç½®ä¸€ä¸ªå…¬å…±é”**ï¼šåˆ©ç”¨setnxå‘½ä»¤è¿”å›å€¼ç‰¹å¾ï¼Œæœ‰å€¼å°±è¿”å›è®¾ç½®å¤±è´¥ï¼ˆæ— æ§åˆ¶æƒï¼‰ï¼Œæ— å€¼åˆ™è¿”å›è®¾ç½®æˆåŠŸï¼ˆæœ‰æ§åˆ¶æƒï¼‰ï¼Œæ“ä½œå®Œæ¯•é€šè¿‡delæ“ä½œé‡Šæ”¾é”

```sql
setnx lock-key value
```



> ä¸šåŠ¡åœºæ™¯
>
> ä¾èµ–åˆ†å¸ƒå¼é”çš„æœºåˆ¶ï¼ŒæŸä¸ªç”¨æˆ·æ“ä½œæ—¶å¯¹åº”å®¢æˆ·ç«¯å½“å³ï¼Œä¸”æ­¤æ—¶å·²ç»è·å–åˆ°é”ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ

ä¸šåŠ¡åˆ†æï¼š

- ç”±äºé”æ“ä½œç”±ç”¨æˆ·æ§åˆ¶åŠ é”è§£é”ï¼Œå¿…å®šä¼šå­˜åœ¨åŠ é”åä¸è§£é”çš„é£é™©
- éœ€è¦è§£é”æ“ä½œä¸èƒ½ä»…ä¾èµ–ç”¨æˆ·æ§åˆ¶ï¼Œç³»ç»Ÿçº§åˆ«è¦ç»™å‡ºä¿åº•å¤„ç†æ–¹æ¡ˆ

è§£å†³æ–¹æ¡ˆ

- ä½¿ç”¨expireä¸ºé”keyæ·»åŠ æ—¶é—´é™åˆ¶

```sql
expire lock-key second
pexpire lock-key milliseconds
```

## ğŸ˜Š åˆ é™¤ç­–ç•¥

### è¿‡æœŸæ•°æ®

Redisæ˜¯ä¸€ç§å†…å­˜çº§çš„æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®å‡å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜ä¸­çš„æ•°æ®å¯ä»¥é€šè¿‡TTLæŒ‡ä»¤è·å–å…¶çŠ¶æ€

- XXï¼šå…·æœ‰æ—¶æ•ˆæ€§çš„æ•°æ®
- -1ï¼šæ°¸ä¹…æœ‰æ•ˆçš„æ•°æ®
- -2ï¼š**å·²ç»è¿‡æœŸçš„æ•°æ®**æˆ–**è¢«åˆ é™¤çš„æ•°æ®**æˆ–**æœªå®šä¹‰çš„æ•°æ®**

### åˆ é™¤ç­–ç•¥

#### æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210418111159381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NjUwODk5,size_16,color_FFFFFF,t_70)



> åˆ é™¤ç­–ç•¥çš„ç›®æ ‡

åœ¨å†…å­˜å ç”¨å’Œcpuå ç”¨ä¹‹é—´å¯»æ‰¾å¹³è¡¡ç‚¹

#### å®šæ—¶åˆ é™¤

**1ã€åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“keyè®¾ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¸”è¿‡æœŸæ—¶é—´åˆ°è¾¾ï¼Œç”±å®šæ—¶å™¨ä»»åŠ¡ç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œ**

2ã€ä¼˜ç‚¹ï¼šèŠ‚çº¦å†…å­˜ï¼Œå¿«é€Ÿé‡Šæ”¾

3ã€ç¼ºç‚¹ï¼šcpuå‹åŠ›å¾ˆå¤§ï¼Œä¼šå½±å“redisæœåŠ¡å™¨çš„å“åº”æ—¶é•¿ã€ååé‡

4ã€æ€»ç»“ï¼šæ—¶é—´æ¢ç©ºé—´

#### æƒ°æ€§åˆ é™¤

**1ã€æ•°æ®åˆ°è¾¾è¿‡æœŸæ—¶é—´ä¸å¤„ç†ï¼Œç­‰ä¸‹æ¬¡è®¿é—®è¯¥æ•°æ®æ—¶å¦‚æœå·²ç»è¿‡æœŸå°±åˆ é™¤**

2ã€`expirelfNeeded()`ï¼šæ£€æŸ¥æ•°æ®è¿‡æœŸ

3ã€ä¼˜ç‚¹ï¼šèŠ‚çº¦cpuæ€§èƒ½

4ã€ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¾ˆå¤§ï¼Œå‡ºç°é•¿æœŸå ç”¨å†…å­˜çš„æ•°æ®

5ã€æ€»ç»“ï¼šå­˜å‚¨ç©ºé—´æ¢å¤„ç†å™¨æ€§èƒ½

#### å®šæœŸåˆ é™¤

1ã€è¿‡ç¨‹

- RedisæœåŠ¡å™¨åˆå§‹åŒ–æ—¶ï¼Œè¯»å–é…ç½®server.hzçš„å€¼ï¼Œé»˜è®¤ä¸º10ï¼›
- æ¯ç§’é’Ÿæ‰§è¡Œserver.hzæ¬¡`serverCron()->databasesCron()-> activeExpireCycle()`
- `activeExpireCycle()`å¯¹æ¯ä¸ªexpires[*]é€ä¸€æ£€æµ‹ï¼ŒéšæœºæŒ‘é€‰wä¸ªkeyæ£€æµ‹
  - å¦‚æœkeyè¶…æ—¶å°±åˆ é™¤
  - å¦‚æœä¸€è½®ä¸­åˆ é™¤çš„keyæ•°é‡>w * 0.25å¾ªç¯è¯¥è¿‡ç¨‹
  - å¦‚æœå°äºç­‰äºå°±æ£€æŸ¥ä¸‹ä¸€ä¸ªexpires[*]ï¼Œ0-15å¾ªç¯
  - wå€¼åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®

- å‚æ•°current_dbç”¨äºè®°å½•`activeExpireCycle()`è¿›å…¥å“ªä¸€ä¸ªexpires[*]æ‰§è¡Œ
- å¦‚æœ`activeExpireCycle()`æ‰§è¡Œæ—¶é—´åˆ°æœŸï¼Œä¸‹æ¬¡ä»current_å¯¹æ¯”ç»§ç»­æ‰§è¡Œ

**2ã€å‘¨æœŸæ€§è½®è¯¢redisåº“ä¸­çš„æ—¶æ•ˆæ€§æ•°æ®ï¼Œé‡‡ç”¨éšæœºæŠ½å–çš„ç­–ç•¥ï¼Œåˆ©ç”¨è¿‡æœŸæ•°æ®å æ¯”çš„æ–¹å¼æ§åˆ¶åˆ é™¤é¢‘ç‡**

3ã€ç‰¹ç‚¹ï¼š

- cpuæ€§èƒ½å ç”¨è®¾ç½®æœ‰å³°å€¼ï¼Œæ£€æµ‹é¢‘ç‡å¯ä»¥è‡ªå®šä¹‰è®¾ç½®
- å†…å­˜å‹åŠ›ä¸æ˜¯å¾ˆå¤§ï¼Œé•¿æœŸå ç”¨å†…å­˜çš„å†·æ•°æ®ä¼šè¢«æŒç»­æ¸…ç†

**4ã€æ€»ç»“ï¼šå‘¨æœŸæ€§æŠ½æŸ¥**

#### æ¯”å¯¹

**1ã€å®šæ—¶åˆ é™¤**

- å®šä¹‰è®¡æ—¶å™¨ï¼Œè¿‡æœŸå°±åˆ é™¤
- èŠ‚çº¦å†…å­˜ï¼Œæ— å ç”¨
- ä¸åˆ†æ—¶é—´å ç”¨cpu

**2ã€æƒ°æ€§åˆ é™¤**

- ä¸‹æ¬¡è®¿é—®å°±åˆ é™¤
- å†…å­˜å ç”¨ä¸¥é‡
- cpuåˆ©ç”¨ç‡é«˜

**3ã€å®šæœŸåˆ é™¤**

- è½®è¯¢redisåº“ï¼ŒéšæœºæŠ½æŸ¥
- æ¯ç§’èŠ±è´¹å›ºå®šçš„cpuèµ„æºç»´æŠ¤

### å†…å­˜æ·˜æ±°æœºåˆ¶

> å¦‚æœæ–°æ•°æ®è¿›å…¥redisæ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

redisä½¿ç”¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œæ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤å‰ï¼Œä¼šè°ƒç”¨`freeMemoryifNeeded()`æ£€æµ‹å†…å­˜æ˜¯å¦å……è¶³

**å¦‚æœå†…å­˜ä¸æ»¡è¶³æ–°åŠ å…¥æ•°æ®çš„æœ€ä½å­˜å‚¨è¦æ±‚ï¼Œredisè¦ä¸´æ—¶åˆ é™¤ä¸€äº›æ•°æ®ï¼Œæ¸…ç†æ•°æ®çš„ç­–ç•¥ä¸ºé€å‡ºç®—æ³•**

#### é…ç½®

æœ€å¤§å¯ç”¨å†…å­˜

```sql
maxmemory
```

æ¯æ¬¡é€‰å–å¾…åˆ é™¤æ•°æ®ä¸ªæ•°

```sql
maxmemory-samples
```

åˆ é™¤ç­–ç•¥

```sql
maxmemory-policy
```

#### æ£€æµ‹æ˜“å¤±æ•°æ®

**å¯èƒ½ä¼šè¿‡æœŸçš„key**

- `voliate-lru`ï¼šæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆæ—¶é—´ä¸Šï¼‰çš„æ•°æ®è¿›è¡Œæ•°æ®æ·˜æ±°ï¼ˆLRUï¼‰
- `voliate-lfu`ï¼šæŒ‘é€‰æœ€è¿‘ä½¿ç”¨æ¬¡æ•°æœ€å°‘ï¼ˆæ¬¡æ•°ä¸Šï¼‰çš„æ•°æ®æ·˜æ±°ï¼ˆLFUï¼‰
- `volatile-ttl`ï¼šæŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°
- `volatile-random`ï¼šä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°

#### æ£€æµ‹å…¨åº“æ•°æ®

**æ‰€æœ‰key**

- `allkeys-lru`
- `allkeys-lfu`
- `allkeys-random`ï¼šä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°

#### æ”¾å¼ƒæ•°æ®é©±é€

- `noenviction`ï¼šç¦æ­¢é©±é€

### LRUç®—æ³•

> æ˜¯ä»€ä¹ˆï¼Ÿ

Least Recently usedï¼Œ**å¸¸ç”¨é¡µé¢ç½®æ¢ç®—æ³•**

**é€‰æ‹©æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®æ·˜æ±°**

https://leetcode-cn.com/problems/lru-cache/

**æ ¸å¿ƒï¼šå“ˆå¸Œé“¾è¡¨**

- æœ¬è´¨ï¼šHashMap+DoubleLinkedList

#### æ‰‹å†™LRU

```java
public class LRUCache{
  //NodeèŠ‚ç‚¹ä½œä¸ºæ•°æ®è½½ä½“
  class Node<k,v>{
    k key;
    v value;
    Node<k,v> prev;
    Node<k,v> next;
    public Node(){
      this.prev=this.next=null;
    }
    public Node(k key,v value){
      this.key=key;
      this.value=value;
      this.prev=this.next=null;
    }
  }

  //åŒå‘é“¾è¡¨ï¼Œé‡Œé¢æ”¾node
  class DoubleLinkedList<k,v>{
    Node<k,v> head;
    Node<k,v> tail;

    public DoubleLinkedList() {
      head=new Node<>();
      tail=new Node<>();
      head.next=tail;
      tail.prev=head;
    }
    //æ·»åŠ åˆ°å¤´
    public void addHead(Node<k,v> node){
      node.prev=head;
      node.next=tail.next;
      head.next.prev=node;
      head.next=node;
    }

    //åˆ é™¤èŠ‚ç‚¹
    public void removeNode(Node<k,v> node){
      node.next.prev=node.prev;
      node.prev.next=node.next;
      node.next=null;
      node.prev=null;
    }

    //è·å¾—æœ€åä¸€ä¸ªèŠ‚ç‚¹
    public Node<k,v> getLast(){
      return tail.prev;
    }
  }

  //ç¼“å­˜å‘ä½
  private int capacity;
  Map<Integer,Node<Integer,Integer>> map;
  DoubleLinkedList<Integer,Integer> doubleLinkedList;

  public LRUCache(int capacity){
    this.capacity=capacity;
    map=new HashMap<>();
    doubleLinkedList=new DoubleLinkedList<>();
  }

  public int get(int key){
    if(!map.containsKey(key)){
      return -1;
    }
    Node<Integer, Integer> node = map.get(key);
    doubleLinkedList.removeNode(node);
    doubleLinkedList.addHead(node);
    return node.value;
  }

  public void put(int key,int value){
    if(map.containsKey(key)){
      Node<Integer, Integer> node = map.get(key);
      node.value=value;
      map.put(key,node);
      doubleLinkedList.removeNode(node);
      doubleLinkedList.addHead(node);
    }else {
      if(map.size()==capacity){
        Node<Integer, Integer> last = doubleLinkedList.getLast();
        map.remove(last.key);
        doubleLinkedList.removeNode(last);
      }else {
        Node<Integer,Integer> newNode = new Node<>(key,value);
        map.put(key,newNode);
        doubleLinkedList.addHead(newNode);
      }
    }

  }
}
```