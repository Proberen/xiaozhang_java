# 并发编程的挑战

## 上下文切换

1、即使是单核处理器也支持多线程，CPU通过给每一个线程分配<span style="background: yellow;">CPU时间片</span>来实现这个机制。

2、**上下文切换**：CPU通过时间片分配算法来循环执行任务，当前任务执行一个时间片后会切换到下一个任务；但是在切换前会保存上一个任务的状态，以便切换回这个任务。<span style="background: yellow;">任务从保存到再次加载的过程就是一次上下文切换</span>

3、减少上下文切换的方法：

- **无锁并发编程**：使用一些方法避免使用锁
- **CAS算法**：使用CAS算法更新数据，不需要加锁
- **使用最少线程和使用线程**：避免创建不需要的线程
- **使用协程**：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换

## 死锁

避免死锁的几个方法：

- 避免一个线程同时获取多个锁
- 避免一个线程在锁内同时占用多个资源
- 使用lock.trylock()来替代使用内部锁机制
- 对于数据库锁，加锁和解锁在一个数据库连接里

